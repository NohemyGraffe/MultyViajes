<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Crear Cotización</title>
  <link rel="stylesheet" href="cotizacion.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>

<header>
  <img src="logo.png" alt="Logo" class="logo">
  <h1>Sistema de gestión de datos</h1>
</header>

<!-- Top Buttons -->
<div class="top-buttons">
  <button class="btn gray" onclick="window.location.href='index.html'">Inicio</button>
  <button class="btn red">Guardar</button>
  <!-- Button that triggers the voucher/resumen creation -->
  <button class="btn blue" onclick="openVoucherPage()">Crear resumen de la cotización</button>
</div>

<div class="layout">
  <div class="main-content">
    <h2>Crear cotización</h2>

    <!-- Hotel Information -->
    <section class="hotel-info">
      <h3>Información del hotel</h3>
      <table>
        <thead>
          <tr>
            <th>Nombre del hotel</th>
            <th>Tipo de habitación</th>
            <th>No. de huéspedes</th>
            <th>Fechas</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" placeholder="Ingrese el nombre" required></td>
            <td><input type="text" placeholder="Ej. Doble, Suite" required></td>
            <td><input type="number" required></td>
            <td><input type="date" required> - <input type="date" required></td>
          </tr>
        </tbody>
      </table>
      <button class="btn small" data-action="add-hotel">
        <i class="fas fa-plus"></i> Agregar hotel
      </button>
    </section>

    <!-- Itinerary -->
    <section class="itinerary">
      <h3>Itinerario</h3>
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Actividad</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="date" required></td>
            <td><input type="time" required></td>
            <td><input type="text" placeholder="Descripción" required></td>
          </tr>
        </tbody>
      </table>
      <button class="btn small" data-action="add-activity">
        <i class="fas fa-plus"></i> Agregar actividad
      </button>
    </section>

    <!-- Service Costs (Costos del servicio) -->
    <section class="service-costs costos-servicio-section">
      <div class="costos-header">
        <h3>Costos del servicio por persona</h3>
        <div class="currency-container">
          <label for="currency-select" class="currency-label">Tipo de moneda:</label>
          <select id="currency-select">
            <option value="USD" data-symbol="USD">USD</option>
            <option value="EUR" data-symbol="EUR">EUR</option>
            <option value="COP" data-symbol="COP" selected>COP</option>
          </select>
        </div>
      </div>
      
      <table>
        <!-- Alojamiento row: label "Precio interno" only -->
        <tr>
          <td>Alojamiento</td>
          <td>
            <label>Precio interno</label><br>
            <input type="text" placeholder="Costo Alojamiento" required id="costo-alojamiento">
          </td>
        </tr>

        <!-- Traslado row: label "Precio interno" only -->
        <tr>
          <td>Traslado</td>
          <td>
            <label>Precio interno</label><br>
            <input type="text" placeholder="Costo Traslado" required id="costo-traslado">
          </td>
        </tr>

        <!-- Combined row for "Alojamiento + Traslado": label "Precio de venta" -->
        <tr>
          <td>Alojamiento + Traslado</td>
          <td>
            <label>Precio de venta</label><br>
            <input type="text" placeholder="Precio de venta" required id="venta-alojamiento-traslado">
          </td>
        </tr>

        <!-- Tours row remains unchanged -->
        <tr>
            <td>Tours y paquetes</td>
            <td>
              <div class="multi-select" id="tour-dropdown">
                <div class="select-box">Seleccionar<i class="fas fa-chevron-down"></i></div>
                <div class="dropdown">
                  <!-- Tour #1: Two data attributes for internal/venta prices -->
                  <label>
                    City Tour 
                    <small>(Interno: COP 84,000 / Venta: COP 120,000)</small>
                    <input
                      type="checkbox"
                      value="city-tour"
                      data-price-interno="84000"
                      data-price-venta="120000"
                    />
                  </label>
          
                  <!-- Tour #2 -->
                  <label>
                    Guatapé
                    <small>(Interno: COP 86,000 / Venta: COP 128,000)</small>
                    <input
                      type="checkbox"
                      value="guatape"
                      data-price-interno="86000"
                      data-price-venta="128000"
                    />
                  </label>
          
                  <!-- Tour #3 -->
                  <label>
                    Hacienda Nápoles
                    <small>(Interno: COP 196,000 / Venta: COP 260,000)</small>
                    <input
                      type="checkbox"
                      value="bogota"
                      data-price-interno="196000"
                      data-price-venta="260000"
                    />
                  </label>
          
                  <!-- Tour #4 -->
                  <label>
                    Santa Fé de Antioquia
                    <small>(Interno: COP 90,000 / Venta: COP 140,000)</small>
                    <input
                      type="checkbox"
                      value="san-andres"
                      data-price-interno="90000"
                      data-price-venta="140000"
                    />
                  </label>

                  <!-- Tour #5 -->
                  <label>
                    Chiva Rumbera
                    <small>(Interno: COP 40,000 / Venta: COP 72,000)</small>
                    <input
                      type="checkbox"
                      value="san-andres"
                      data-price-interno="40000"
                      data-price-venta="72000"
                    />
                  </label>

                  <!-- Tour #6 -->
                  <label>
                    Tour Rio Claro
                    <small>(Interno: COP 196,000 / Venta: COP 260,000)</small>
                    <input
                      type="checkbox"
                      value="san-andres"
                      data-price-interno="196000"
                      data-price-venta="260000"
                    />
                  </label>

                  <!-- Tour #7 -->
                  <label>
                    Tour Silletero
                    <small>(Interno: COP 97,000 / Venta: COP 160,000)</small>
                    <input
                      type="checkbox"
                      value="san-andres"
                      data-price-interno="97000"
                      data-price-venta="160000"
                    />
                  </label>

                <!-- Tour #8 -->
                  <label>
                    Tour Café
                    <small>(Interno: COP 169,000 / Venta: COP 220,000)</small>
                    <input
                      type="checkbox"
                      value="san-andres"
                      data-price-interno="196000"
                      data-price-venta="220000"
                    />
                  </label>

                </div>
              </div>
            </td>
          </tr>
          

          <tr>
            <td>Costos adicionales</td>
            <td>
              <!-- Group "Precio interno" and "Precio de venta" side by side -->
              <div style="display: flex; gap: 20px; align-items: flex-start;">
                <!-- First column for Precio interno -->
                <div>
                  <label>Precio interno</label><br>
                  <input
                    type="text"
                    placeholder="Total"
                    required
                    id="costo-adicional-total"
                    style="width: 140px;"
                  >
                </div>
          
                <!-- Second column for Precio de venta -->
                <div>
                  <label>Precio de venta</label><br>
                  <input
                    type="text"
                    placeholder="Precio de venta"
                    required
                    id="venta-adicional"
                    style="width: 140px;"
                  >
                </div>
              </div>
          
              <!-- Below, the existing "Descripción" input remains as is -->
              <br>
              <input
                type="text"
                placeholder="Descripción"
                required
                style="width: 50%;"
              >
            </td>
          </tr>
          
          <tr>
            <td>Total en servicios por persona </td>
            <td>
              <div style="display: flex; gap: 30px; align-items: flex-start;">
                <!-- Left: Output for internal total -->
                <div style="display: flex; flex-direction: column;">
                  <label style="font-size: 13px;">Precio interno en COP</label>
                  <input
                    type="text"
                    id="total-servicios"
                    placeholder="Suma interno"
                    readonly
                    style="width: 120px;"
                  >
                </div>
          
                <!-- Right: Output for "precio de venta" in USD -->
                <div style="display: flex; flex-direction: column;">
                  <label style="font-size: 13px;">Precio de venta en USD</label>
                  <input
                    type="text"
                    id="total-venta-usd"
                    placeholder="Venta USD"
                    readonly
                    style="width: 130px;"
                  >
                </div>
              </div>
            </td>
          </tr>
          
      </table>

      <!-- CSS for Tours Dropdown -->
      <style> 
        .multi-select {
          position: relative;
          width: 100%;
        }
      
        .multi-select .select-box {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 5px;
          background-color: #fff;
          cursor: pointer;
        }
      
        .multi-select .dropdown {
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          max-height: 150px;
          overflow-y: auto;
          border: 1px solid #ccc;
          border-radius: 5px;
          background-color: #fff;
          z-index: 10;
          display: none;
          box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }
      
        .multi-select .dropdown label {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px;
          cursor: pointer;
          font-size: 14px;
        }
      
        /* Light blue hover color */
        .multi-select .dropdown label:hover {
          background-color: #cceeff;
        }
      
        /* Add spacing between tour name and the <small> text */
        .multi-select .dropdown label small {
          margin-left: 12px; /* Increase as desired for more spacing */
        }
      
        .multi-select .dropdown input[type="checkbox"] {
          margin-left: 10px;
        }
      </style>
      

      <!-- JS for Tours Dropdown -->
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const multiSelect = document.getElementById('tour-dropdown');
          const selectBox = multiSelect.querySelector('.select-box');
          const dropdown = multiSelect.querySelector('.dropdown');

          selectBox.addEventListener('click', () => {
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
          });

          document.addEventListener('click', (e) => {
            if (!multiSelect.contains(e.target)) {
              dropdown.style.display = 'none';
            }
          });
        });
      </script>
    </section>

<!-- Cálculo de cotización -->
<section class="quotation-calculation">
    <h3>Cálculo de cotización</h3>
    <table>
      <!-- Replace the original "Número de personas" row with the snippet below -->
      <tr>
        <td>Número de personas</td>
        <td>
          <!-- Container for the number input + two output fields -->
          <div style="display: flex; flex-direction: column; gap: 8px;">
            
            <!-- (1) The input field for número de personas -->
            <input
              type="number"
              id="numero-personas"
              placeholder="Ingrese la cantidad"
              required
              style="width: 150px;"
            >
            
            <!-- (2) A row containing both new output fields side by side -->
            <div style="display: flex; gap: 20px;">
              
              <!-- Left column: "Precio interno en COP" -->
              <div style="display: flex; flex-direction: column;">
                <label style="font-size: 13px;">Precio interno en COP</label>
                <input
                  type="text"
                  id="precio-interno-cop"
                  placeholder="0.00"
                  readonly
                  style="width: 130px;"
                >
              </div>
              
              <!-- Right column: "Precio de venta en COP" -->
              <div style="display: flex; flex-direction: column;">
                <label style="font-size: 13px;">Precio de venta en COP</label>
                <input
                  type="text"
                  id="precio-venta-cop"
                  placeholder="0.00"
                  readonly
                  style="width: 130px;"
                >
              </div>
            </div>
          </div>
        </td>
      </tr>
  
    </table>
  </section>
  

    <!-- Payments and Profits -->
    <section class="payments-profits">
      <h3>Utilidades / Ganancias de la empresa</h3>
      <table>

        <tr>
          <td>Ganancias / Utilidades (COP)</td>
          <td>
            <div style="display: flex; align-items: center;">
              <input type="text" id="ganancias" placeholder="0.00" readonly>
              <span id="currency-ganancias-symbol" style="margin-left: 5px;">$</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>Utilidad por persona (COP)</td>
          <td>
            <div style="display: flex; align-items: center;">
              <input type="text" id="utilidad-persona" placeholder="0.00" readonly>
              <span id="currency-utilidad-symbol" style="margin-left: 5px;">$</span>
            </div>
          </td>
        </tr>
      </table>
    </section>

  </div>
</div>

<!-- JavaScript: Gather data and open "cotizacion-voucher.html" -->
<script>
  function openVoucherPage() {
    // 1) Gather relevant form data
    const hotelName       = document.querySelector('input[placeholder="Ingrese el nombre"]').value;
    const acomodacion     = document.querySelector('input[placeholder="Ej. Doble, Suite"]').value;
    const itineraryRows   = document.querySelectorAll('.itinerary table tbody tr');
    const numeroPersonas  = document.getElementById('numero-personas').value;
    const precioPersona   = document.getElementById('precio-por-persona').value;
    const totalCotizacion = document.getElementById('monto-cotizacion').value;
    const montoCliente    = document.getElementById('monto-cliente').value;

    // 2) Format the itinerario data
    let itinerarioText = '';
    itineraryRows.forEach(row => {
      const dateInput = row.querySelector('input[type="date"]').value;
      const timeInput = row.querySelector('input[type="time"]').value;
      const activity  = row.querySelector('input[placeholder="Descripción"]').value;

      if (dateInput || timeInput || activity) {
        // Example format: "2023-04-12 / 09:00 / City Tour"
        itinerarioText += `${dateInput} / ${timeInput} / ${activity}\n`;
      }
    });

    // 3) Create a "Cotización ID" (simple approach)
    let lastId = localStorage.getItem('lastCotizacionId') || 0;
    lastId = parseInt(lastId, 10) + 1;
    localStorage.setItem('lastCotizacionId', lastId);

    // 4) Build query params
    const params = new URLSearchParams({
      id:              lastId,
      hotel:           hotelName,
      acomodacion:     acomodacion,
      itinerario:      itinerarioText,
      numeroPersonas:  numeroPersonas,
      precioPersona:   precioPersona,
      totalPagar:      totalCotizacion,
      montoCliente:    montoCliente
    });

    // 5) Navigate to "cotizacion-voucher.html"
    window.location.href = `cotizacion-voucher.html?${params.toString()}`;
  }
</script>

<!-- Link your main JS file at the end (with cost calculations, currency, etc.) -->
<script src="cotizacion.js"></script>
</body>
</html>
