<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear Cotización</title>
  <link rel="stylesheet" href="cotizacion.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>

<header>
  <img src="logo.png" alt="Logo" class="logo">
  <h1>Sistema de gestión de datos</h1>
</header>

<!-- Top Buttons -->
<div class="top-buttons">
  <button class="btn gray" onclick="window.location.href='index.html'">Inicio</button>
  <button class="btn red">Guardar</button>
  <!-- Modified "Crear voucher" button to call openVoucherPage() -->
  <button class="btn blue" onclick="openVoucherPage()">Crear resumen de la cotización</button>
</div>

<div class="layout">
  <div class="main-content">
    <h2>Crear cotización</h2>

    <!-- Hotel Information -->
    <section class="hotel-info">
      <h3>Información del hotel</h3>
      <table>
        <thead>
          <tr>
            <th>Nombre del hotel</th>
            <th>Tipo de habitación</th>
            <th>No. de huéspedes</th>
            <th>Fechas</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <!-- Example placeholders for relevant data -->
            <td><input type="text" placeholder="Ingrese el nombre" required></td>
            <td><input type="text" placeholder="Ej. Doble, Suite" required></td>
            <td><input type="number" required></td>
            <td><input type="date" required> - <input type="date" required></td>
          </tr>
        </tbody>
      </table>
      <button class="btn small" data-action="add-hotel">
        <i class="fas fa-plus"></i> Agregar hotel
      </button>
    </section>

    <!-- Itinerary -->
    <section class="itinerary">
      <h3>Itinerario</h3>
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Actividad</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="date" required></td>
            <td><input type="time" required></td>
            <td><input type="text" placeholder="Descripción" required></td>
          </tr>
        </tbody>
      </table>
      <button class="btn small" data-action="add-activity">
        <i class="fas fa-plus"></i> Agregar actividad
      </button>
    </section>

    <!-- Service Costs (Costos del servicio) -->
    <section class="service-costs costos-servicio-section">
      <div class="costos-header">
        <h3>Costos del servicio</h3>
        <div class="currency-container">
          <label for="currency-select" class="currency-label">Tipo de moneda:</label>
          <select id="currency-select">
            <option value="USD" data-symbol="USD">USD</option>
            <option value="EUR" data-symbol="EUR">EUR</option>
            <option value="COP" data-symbol="COP" selected>COP</option>
          </select>
        </div>
      </div>
      
      <table>
        <tr>
          <td>Alojamiento</td>
          <td><input type="text" placeholder="Costo Alojamiento" required id="costo-alojamiento"></td>
        </tr>
        <tr>
          <td>Traslado</td>
          <td><input type="text" placeholder="Costo Traslado" required id="costo-traslado"></td>
        </tr>
<!-- In the "Tours" row -->
<tr>
    <td>Tours</td>
    <td>
      <div class="multi-select" id="tour-dropdown">
        <div class="select-box">Seleccionar tours <i class="fas fa-chevron-down"></i></div>
        <div class="dropdown">
          <!-- Each label has a data-price attribute on the checkbox -->
          <label>
            City Tour (20000Cop)
            <input type="checkbox" value="city-tour" data-price="20000">
          </label>
          <label>
            Guatapé (35000Cop)
            <input type="checkbox" value="guatape" data-price="35000">
          </label>
          <label>
            Bogotá (40000Cop)
            <input type="checkbox" value="bogota" data-price="40000">
          </label>
          <label>
            San Andrés (40000Cop)
            <input type="checkbox" value="san-andres" data-price="40000">
          </label>
        </div>
      </div>
    </td>
  </tr>
  
        <tr>
          <td>Costos adicionales</td>
          <td>
            <input type="text" placeholder="Total" required id="costo-adicional-total" style="width: 50%">
            <input type="text" placeholder="Descripción" required style="width: 50%">
          </td>
        </tr>
        <tr>
          <td>Total servicios</td>
          <td>
            <div style="display: flex; align-items: center;">
              <input type="text" id="total-servicios" placeholder="Total Servicios" readonly>
              <span id="currency-symbol" style="margin-left: 5px;">$</span>
            </div>
          </td>
        </tr>
      </table>

      <!-- CSS for Tours Dropdown -->
      <style>
        .multi-select {
          position: relative;
          width: 100%;
        }

        .multi-select .select-box {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 5px;
          background-color: #fff;
          cursor: pointer;
        }

        .multi-select .dropdown {
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          max-height: 150px;
          overflow-y: auto;
          border: 1px solid #ccc;
          border-radius: 5px;
          background-color: #fff;
          z-index: 10;
          display: none;
          box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }

        .multi-select .dropdown label {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px;
          cursor: pointer;
          font-size: 14px;
        }

        .multi-select .dropdown label:hover {
          background-color: #f0f0f0;
        }

        .multi-select .dropdown input[type="checkbox"] {
          margin-left: 10px;
        }
      </style>

      <!-- JS for Tours Dropdown -->
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const multiSelect = document.getElementById('tour-dropdown');
          const selectBox = multiSelect.querySelector('.select-box');
          const dropdown = multiSelect.querySelector('.dropdown');

          selectBox.addEventListener('click', () => {
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
          });

          document.addEventListener('click', (e) => {
            if (!multiSelect.contains(e.target)) {
              dropdown.style.display = 'none';
            }
          });
        });
      </script>
    </section>

    <!-- Quotation Calculation -->
    <section class="quotation-calculation">
      <h3>Cálculo de cotización</h3>
      <table>
        <tr>
          <td>Número de personas</td>
          <td><input type="number" id="numero-personas" placeholder="Ingrese la cantidad" required></td>
        </tr>
        <tr>
          <td>Precio por persona</td>
          <td><input type="text" id="precio-por-persona" placeholder="0.00" readonly></td>
        </tr>
        <tr>
          <td>Monto total de la cotización</td>
          <td>
            <div style="display: flex; align-items: center;">
              <input type="text" id="monto-cotizacion" placeholder="0.00" readonly>
              <span id="currency-cotizacion-symbol" style="margin-left: 5px;">$</span>
            </div>
          </td>
        </tr>
      </table>
    </section>

    <!-- Payments and Profits -->
    <section class="payments-profits">
      <h3>Pagos y ganancias</h3>
      <table>
        <tr>
          <td>Monto pagado por el cliente</td>
          <td><input type="text" id="monto-cliente" required></td>
        </tr>
        <tr>
          <td>Ganancias / Utilidades</td>
          <td>
            <div style="display: flex; align-items: center;">
              <input type="text" id="ganancias" placeholder="0.00" readonly>
              <span id="currency-ganancias-symbol" style="margin-left: 5px;">$</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>Utilidad por persona</td>
          <td>
            <div style="display: flex; align-items: center;">
              <input type="text" id="utilidad-persona" placeholder="0.00" readonly>
              <span id="currency-utilidad-symbol" style="margin-left: 5px;">$</span>
            </div>
          </td>
        </tr>
      </table>
    </section>

  </div>
</div>

<!-- JavaScript: Gather data and open "cotizacion-voucher.html" -->
<script>
  function openVoucherPage() {
    // 1) Gather relevant form data
    const hotelName       = document.querySelector('input[placeholder="Ingrese el nombre"]').value;
    const acomodacion     = document.querySelector('input[placeholder="Ej. Doble, Suite"]').value;
    const itineraryRows   = document.querySelectorAll('.itinerary table tbody tr');
    const numeroPersonas  = document.getElementById('numero-personas').value;
    const precioPersona   = document.getElementById('precio-por-persona').value;
    const totalCotizacion = document.getElementById('monto-cotizacion').value;
    const montoCliente    = document.getElementById('monto-cliente').value;

    // 2) Format the itinerario data
    let itinerarioText = '';
    itineraryRows.forEach(row => {
      const dateInput = row.querySelector('input[type="date"]').value;
      const timeInput = row.querySelector('input[type="time"]').value;
      const activity  = row.querySelector('input[placeholder="Descripción"]').value;

      if (dateInput || timeInput || activity) {
        // Example format: "2023-04-12 / 09:00 / City Tour"
        itinerarioText += `${dateInput} / ${timeInput} / ${activity}\n`;
      }
    });

    // 3) Create a "Cotización ID" (simple approach)
    let lastId = localStorage.getItem('lastCotizacionId') || 0;
    lastId = parseInt(lastId, 10) + 1;
    localStorage.setItem('lastCotizacionId', lastId);

    // 4) Build query params
    const params = new URLSearchParams({
      id:              lastId,
      hotel:           hotelName,
      acomodacion:     acomodacion,
      itinerario:      itinerarioText,
      numeroPersonas:  numeroPersonas,
      precioPersona:   precioPersona,
      totalPagar:      totalCotizacion,
      montoCliente:    montoCliente
    });

    // 5) Navigate to "cotizacion-voucher.html"
    window.location.href = `cotizacion-voucher.html?${params.toString()}`;
  }
</script>

<!-- Link your main JS file at the end (with cost calculations, currency, etc.) -->
<script src="cotizacion.js"></script>
</body>
</html>
